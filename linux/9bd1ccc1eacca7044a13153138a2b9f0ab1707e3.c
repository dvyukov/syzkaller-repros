// general protection fault in kvm_ioapic_scan_entry
// https://syzkaller.appspot.com/bug?id=9bd1ccc1eacca7044a13153138a2b9f0ab1707e3
// status:fixed
// autogenerated by syzkaller (https://github.com/google/syzkaller)

#define _GNU_SOURCE

#include <endian.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/syscall.h>
#include <sys/types.h>
#include <unistd.h>

uint64_t r[3] = {0xffffffffffffffff, 0xffffffffffffffff, 0xffffffffffffffff};

int main(void)
{
  syscall(__NR_mmap, 0x20000000, 0x1000000, 3, 0x32, -1, 0);
  long res = 0;
  memcpy((void*)0x20000280, "/dev/kvm", 9);
  res = syscall(__NR_openat, 0xffffffffffffff9c, 0x20000280, 0, 0);
  if (res != -1)
    r[0] = res;
  res = syscall(__NR_ioctl, r[0], 0xae01, 0);
  if (res != -1)
    r[1] = res;
  res = syscall(__NR_ioctl, r[1], 0xae41, 0);
  if (res != -1)
    r[2] = res;
  memcpy(
      (void*)0x20000840,
      "\x03\x00\x00\x00\x00\x00\x00\x00\x9d\x00\x00\x40\x00\x00\x00\x00\x02\x00"
      "\x00\x00\x00\x00\x00\x00\x7d\x0b\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
      "\x00\x00\x00\x00\x51\x03\x78\x7e\x00\x94\xb0\x4f\x18\x00\x00\x01\x00\x00"
      "\x00\x00\x57\xe2\xdb\xfb\xdb\x17\x52\x30\x82\xc9\x0e\x99\x63\x54\xb5\x7f"
      "\x79\xcb\xe3\xc9\xb8\xc8\xc8\x7a\x63\xfd\x57\xbb\xc2\x15\xa6\x6b\x51\x93"
      "\x48\x38\xc4\x22\x35\xae\xfe\x92\xea\xc4\xaf\x65\x9f\x33\x2e\x40\x1b\x44"
      "\x64\xb0\x00\x89\x83\xdf\xd4\x20\x97\xd5\xa5\x48\xce\xe5\x7e\x44\x81\x87"
      "\x7b\x6f\xd1\x75\x82\x38\x20\x62\x3f\xd7\xb6\x81\x0e\xbe\x4e\xda\xe6\x55"
      "\xeb\xbc\xd0\xbd\xf2\xfa\x8e\xf5\x83\x90\xe4\x67\x8a\x11\x84\x04\xdd\xf6"
      "\x89\x2d\xfe\x70\x62\x27\xbf\x5f\x47\xee\x2e\x12\xd4\x7f\x52\xd8\x56\x7b"
      "\x96\x55\xe6\x17\xf4\xb2\x2b\x96\x62\x14\x51\x8f\x9c\xdc\x53\xcc\x43\x96"
      "\xad\xab\x1c\xae\xb5\xa9\x60\xd1\x50\x69\xbc\xb1\x44\xf6\xdd\x68\x71\x8f"
      "\x70\x43\x27\xca\xc2\xc9\xfc\xcd\x3b\x93\xa4\x67\x06\xd6\xfe\x39\x1e\x93"
      "\xc0\xdd\xe0\x62\xdd\xf1\x50\xfd\x17\xce\xa9\x7c\xa7\x58\x0c\x09\xfe\x84"
      "\x8e\xc9\xd0\xb7\x47\x31\xe3\xcd\x71\xd6\xa0\x39\xc7\xac\x4c\x57\x4a\x43"
      "\x20\x29\xce\xb1\xdf\xf8\x38\x8e\xe7\x27\x06\x3a\x3f\xc7\x9f\xfb\x16\x64"
      "\x67\x2a\x1b\x79\x2f\x86\x54\xd1\x8e\x2f\x32\x0d\xf5\x61\xbe\x35\xcf\x52"
      "\xb5\xec\xad\x99\x82\xab\xbc\x8b\x38\x6a\x20\xff\x80\xb8\x5a\x84\x01\x4d"
      "\x7b\x09\x25\x83\xf1\xfd\x60\xf9\xb2\x21\xab\xe4\xfd\xe4\x85\x6c\x0e\x42"
      "\x4f\x47\xaf\x1b\x66\xce\xf9\x86\x27\x77\xab\x49\x84\xe0\x82\xb4\x55\x0d"
      "\x76\x0e\x29\x00\x9d\x48\x48\x3e\x6e\xb4\x03\xbf\xc9\x54\xfa\x63\xd6\xda"
      "\xc1\x3a\x77\xbe\x1a\xd5\x8a\x7c\xa4\xfa\xda\x49\xc8\x93\x8d\x8a\x22\xe2"
      "\xd4\x80\x58\x6f\x0a\x26\x70\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
      "\x00\x00\x03\x35\xeb\x21\xf3\xc6\x3e\xa8\xad\xb6\x31\x5a\x1c\x73\x31\x24"
      "\x8e\x7d\xe8\x06\xe1\xda\xe9\x37\xda\xea\x19\xff\xe4\x0d\x56\xa9\x7d\x9d"
      "\xdf\xd7\x32\x5b\xec\x02\x66\x64\xc2\x63\x1f\x9e\x0b\x1a\xb2\xb7\x3e\x41"
      "\x81\xe8\xd1\x5a\x8d\xf4\xcf\xa6\xa0\xe9\xa1\x23\xa3\x9a\xdb\x4a\x8f\xbf"
      "\xc3\xf3\x6e\x6f\x2c\x1e\x2a\xcc\xd6\x72\x0f\x65\x2f\x48\xbc\x6c\x72\x29"
      "\x58\xc6\x6e\xc0\x9a\x0d\xe2\xf2\xa0\x46\x98\xd2\x95\x93\xfb\x67\x3a\xe6"
      "\x9d\xcd\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00",
      536);
  syscall(__NR_ioctl, r[2], 0x4008ae89, 0x20000840);
  syscall(__NR_ioctl, r[2], 0xae80, 0);
  return 0;
}
