// KASAN: stack-out-of-bounds Read in xt_copy_counters_from_user
// https://syzkaller.appspot.com/bug?id=586428bbb1398627181034bd62d40de2503b3b10
// status:fixed
// autogenerated by syzkaller (https://github.com/google/syzkaller)

#define _GNU_SOURCE

#include <endian.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/syscall.h>
#include <sys/types.h>
#include <unistd.h>

#ifndef __NR_mmap
#define __NR_mmap 192
#endif
#ifndef __NR_setsockopt
#define __NR_setsockopt 366
#endif
#ifndef __NR_socket
#define __NR_socket 359
#endif
#undef __NR_mmap
#define __NR_mmap __NR_mmap2

uint64_t r[1] = {0xffffffffffffffff};

int main(void)
{
  syscall(__NR_mmap, 0x20000000, 0x1000000, 3, 0x32, -1, 0);
  long res = 0;
  res = syscall(__NR_socket, 0xa, 1, 0);
  if (res != -1)
    r[0] = res;
  memcpy((void*)0x20000300,
         "\x06\x1a\x63\xe7\x94\xb8\xf3\x0e\xed\xc7\xb7\xca\x7f\x5e\xc9\xc9\xe8"
         "\x83\xfe\x0b\xc8\x57\xeb\x82\xe3\x4b\x3a\xb6\xc8\x68\x7c\x61\xcf\x6a"
         "\x77\x82\x6b\x1c\x36\x63\xd3\x1d\x9f\x6f\x1e\xfc\x1b\xa8\xa8\x8d\xba"
         "\xe5\xba\xeb\x88\x34\x21\x80\xe9\xa7\xc5\x1f\x5b\x6a\x35\x5a\xa1\x98"
         "\xd1\xed\x24\x74\xe4\x4a\xa1\xad\x3f\x0b\xac\xfa\xbb\x7f\x6f\x6a\x15"
         "\x8c\xc4\xc7\xe8\x0b\x66\x27\xbd\x11\xe9\xe3\x8d\xf7\xbc\x56\xff\xa7"
         "\x4c\xaf\xa5\x2e\x4a\xae\x11\x7c\x76\xee\x52\x96\xb3\x3a\x72\x1a\xcf"
         "\x89\x81\x12\xa9\x06\x53\x28\x12\x09\xf5\x7c\x42\xf4\x77\x7f\xbc\xd1"
         "\x85\x89\x54\x5b\x09\x08\x8b\x95\xd7\x8e\x86\x1d\xed\x6c\xaf\x5f\x17"
         "\x81\x5c\xfc\x07\x5d\xe0\x4b\xb7\xde\x90\xcc\xc4\xb5\xa3\xfa\xf3\x66"
         "\x6b\x7b\xd3\x3a\xc4\xac\xcd\x73\x88\x7b\xe7",
         181);
  syscall(__NR_setsockopt, (long)r[0], 0x29, 0x41, 0x20000300, 0xb5);
  return 0;
}
